<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Глава 5. Прикладной протокол FTP</title>

    <style>
        @import url("https://chereshan.github.io/styles/textbook-style.css");
        @import url("../modules/vs2015.min.css");
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../modules/jquery-3.7.1.min.js"><'+'/script>')</script>
    <script src="../modules/highlight.min.js"></script>
    <script src="../scripts/body_scripts.js"></script>
    <script src="../common/counters_head.js"></script>


</head>
<body>
<script src="../common/counters_body.js"></script>

<h1>Глава 5. Прикладной протокол FTP</h1>
<h2>Передача файлов по протоколу FTP</h2>
<p>Типичный FTP-сеанс представляет собой передачу файлов пользователю, сидящим за одним локальным хостом, на другой удаленный хост или обратно. Для этого пользователь должен ввести идентифкатор и пароль, и после чего станет способен передавать файлы из локальной системы в уадленную и обратно.</p>
<p>Как показано на рис. ниже юзер взаимодействует с проколом FTP через пользовательский агент FTP. Сначала пользователь предоставляет имя удаленного хоста, заставляя клиентский процесс на локальном устройстве уствновить TCP-соединение с процессом FTP-сервера на удаленном хосте. Затем вводит идентифкатор и пароль, котоыре отправляются через TCP-соединение в составе FTP-команд. Как только сервер авторизует пользователя, тот может копировать один или несколько файлов, хранящихся на локальной системе, в удаленную систему (или наоборот).</p>
<img src="images/ftp.png" alt="">
<p>Протоколы HTTP и FTP являются протоколами передачи данных и имеют много общего. Они работают поверх протокола TCP. Однако, они также имеют существенные различия: протокол FTP использует для передачи файла 2 параллельных TCP-соединения: <b>управляющее соединение</b> и <b>соединение данных</b>.</p>
<p>Управляющее соединение используется для отправки контрольной информации между двумя хостами - идентификатор юзера, команды для смены каталога, команды передачи и получения данных.</p>
<p>Соединение данных используется для передачи самих файлов</p>
<p>Говорят, что FTP отправляет управляющую информацию <b>вне полосы</b> (<b>out-of-band</b>). В то же время протоккол HTTP отсылает строки заголовов запроса и ответа в одном и том же TCP-соединении вместе с передаваемыми объектами. Таким образом, протокол HTTP отправляет управляющую информацию <b>внутри полосы</b> (<b>in-band</b>). </p>
<img src="images/ftp-client-server.png" alt="">
<ol>
    <li>Юзер начинает FTP-сеанс с удаленным хостом. Клиентская сторона FTP-протокола инициирует управляющее TCP-соединение с серверной стороной по порту 21. Клиент FTP отправялет идентифкатор и пароль пользователя. </li>
    <li>Также по этому передаются команды изменения удаленного каталога.</li>
    <li>Когда серверная сторона получает команду на передачу файла через управляющее соединение, то сервер инициирует TCP-соединение данных с клиентской стороной. FTP отправляет ровно один файл через это соединение и затем закрывает его. Если будет запрошена передача другого файла, то для него будет открыто новое TCP-соединение данных. </li>
</ol>
<p>Таким образом, управляющее TCP-соединение остается открытым в течение всего сеанса, а для передачи каждого файла внутри сеанса будет всякий раз открываться новое TCP-соединение данных, т.е. соединение данных FTP является неопстоянным. </p>
<p>В течение пользовательского сеанса FTP-сервер должен хранить соединение этого сеанса, т.е. серверу надо как-то связывать управляющее соединение с конкретной пользовательской учетной записью, сервер должен отслеживать текущий каталог по мере того, как он пробегает по дереву каталогов. Такое отслеживание состояния значительно ограничивает число одновременно отслуживаемых сеансов FTP.</p>

<h2>Команды и ответы протокола FTP</h2>
<p>Рассмотрим некоторые из наиболее распространенных FTP-команд и ответов.</p>
<p>Команды, посылаемые клиентом серверу, и ответы сервера клиенту передаются по управляющему осединению в виде семиразрядных ASCII-символов.</p>
<p>Для разделения команд используется пара символов: возврат каретки и перевод строки</p>
<p>Каждая команда состоит из 4-х символов ASCII в верхнем регистре и необязательных параметров.</p>
<p>Примеры этих команд представлены ниже: </p>
<ul>
    <li><span class="code">USER username</span>: используется для передачи идентификатора пользователя серверу</li>
    <li><span class="code">PASS password</span>: используется для передачи пользовательского пароля серверу</li>
    <li><span class="code">LIST</span>: используется для запроса у сервера списка всех файлов, находящихся в текущем удаленном каталоге. Список файлов передается
        через соединение данных (новое и непостоянное), а не через управляющее TCP-соединение</li>
    <li><span class="code">RETR filename</span>: используется для вызова (то есть, получения)
        файла из текущего каталога на удаленном хосте. Данная команда
        приводит к тому, что удаленный хост инициирует соединение данных и отправляет запрашиваемый файл через это соединение.</li>
    <li><span class="code">STOR filename</span>: используется для сохранения (то есть отправки)
        файла в текущий каталог удаленного хоста</li>
</ul>
<p>Обычно одной команде, введенной пользователем, соответствует
    одна FTP-команда, отправленная через управляющее соединение. На
    каждую команду сервер дает ответ клиенту. Ответы представляют собой трехзначные числа, сопровождаемые необязательным сообщением</p>
<p>Структура такого ответа похожа на структуру строки состояния ответного HTTP-сообщения с кодом состояния и фразой. Некоторые распространенные ответы FTP-сервера представлены ниже:</p>
<ol>
    <li><span class="code">331 Username OK, password required</span></li>
    <li><span class="code">125 Data connection already open; transfer starting</span></li>
    <li><span class="code">425 Can't open data connection</span></li>
    <li><span class="code">452 Error writing file</span></li>
</ol>
</body>
</html>